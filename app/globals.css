@tailwind base;
@tailwind components;
@tailwind utilities;

/* X1 Payments Design System */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');

:root {
  /* X1 Brand Colors */
  --x1-black: #000000;
  --x1-white: #FFFFFF;
  --x1-gray-50: #F9FAFB;
  --x1-gray-100: #F3F4F6;
  --x1-gray-300: #D1D5DB;
  --x1-gray-400: #9CA3AF;
  --x1-gray-500: #6B7280;
  --x1-gray-600: #4B5563;
  --x1-gray-700: #374151;
  --x1-gray-800: #1F2937;
  --x1-gray-900: #111827;
  
  /* Status Colors */
  --x1-green: #10B981;
  --x1-red: #EF4444;
  --x1-yellow: #F59E0B;
  --x1-blue: #3B82F6;
}

/* Font Configuration */
body {
  font-family: 'Inter', system-ui, sans-serif;
  font-feature-settings: "cv02", "cv03", "cv04", "cv11";
  font-weight: 400;
  line-height: 1.5;
}

/* Premium Visual Effects */
.gradient-bg {
  background: radial-gradient(ellipse at top, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
              radial-gradient(ellipse at bottom, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
}

.premium-gradient {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
}

.glow-effect {
  box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
}

.text-glow {
  text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
}

.button-glow {
  box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
}

.card-glow {
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 40px rgba(255, 255, 255, 0.05);
}

.glass-premium {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

.float-animation {
  animation: float 6s ease-in-out infinite;
}

.gpu-accelerated {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: var(--x1-gray-900);
}

::-webkit-scrollbar-thumb {
  background: var(--x1-gray-600);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--x1-gray-500);
}

/* Focus states */
.focus-ring:focus {
  outline: 2px solid var(--x1-white);
  outline-offset: 2px;
}

/* Custom utility classes */
.text-hero {
  font-size: clamp(3rem, 8vw, 7rem);
  font-weight: 300;
  line-height: 1.05;
}

.transition-premium {
  transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
}

.border-subtle {
  border-color: var(--x1-gray-800);
}

.border-hover {
  border-color: var(--x1-gray-700);
}

/* X1 specific component styles */
.x1-button-primary {
  @apply bg-white text-black px-8 py-4 text-sm font-medium hover:bg-gray-100 transition-premium button-glow;
}

.x1-button-secondary {
  @apply border border-white px-8 py-4 text-sm font-medium hover:bg-white hover:text-black transition-premium;
}

.x1-button-ghost {
  @apply text-gray-400 hover:text-white transition-colors duration-300;
}

.x1-card {
  @apply premium-gradient border border-gray-800 p-6 card-glow hover:border-gray-700 transition-premium;
}

.x1-input {
  @apply w-full bg-transparent border border-gray-600 px-4 py-4 text-sm focus:border-white focus:outline-none transition-premium hover:border-gray-400 premium-gradient glow-effect;
}

/* Status indicators */
.status-success { color: var(--x1-green); }
.status-error { color: var(--x1-red); }
.status-warning { color: var(--x1-yellow); }
.status-info { color: var(--x1-blue); }

.bg-success { background-color: var(--x1-green); }
.bg-error { background-color: var(--x1-red); }
.bg-warning { background-color: var(--x1-yellow); }
.bg-info { background-color: var(--x1-blue); }

/* Accessibility improvements */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Performance optimizations */
* {
  box-sizing: border-box;
}

img {
  max-width: 100%;
  height: auto;
}

/* Mobile optimizations */
@media (max-width: 640px) {
  .x1-card {
    @apply p-4;
  }
  
  .x1-button-primary,
  .x1-button-secondary {
    @apply px-6 py-3;
  }
}
</parameter>
</invoke>
<invoke name="file">
<parameter name="filePath">tailwind.config.ts</parameter>
<parameter name="contentType">content</parameter>
<parameter name="content">import type { Config } from 'tailwindcss'

const config: Config = {
  darkMode: 'class',
  content: [
    './app/**/*.{ts,tsx,js,jsx}',
    './components/**/*.{ts,tsx,js,jsx}',
  ],
  theme: {
    extend: {
      fontFamily: {
        sans: [
          'Inter',
          'system-ui',
          '-apple-system',
          'BlinkMacSystemFont',
          'Segoe UI',
          'Roboto',
          'Oxygen',
          'Ubuntu',
          'Cantarell',
          'sans-serif'
        ],
      },
      colors: {
        // X1 Brand Colors
        x1: {
          black: '#000000',
          white: '#FFFFFF',
          gray: {
            50: '#F9FAFB',
            100: '#F3F4F6',
            300: '#D1D5DB',
            400: '#9CA3AF',
            500: '#6B7280',
            600: '#4B5563',
            700: '#374151',
            800: '#1F2937',
            900: '#111827',
          }
        },
        // Status Colors
        success: '#10B981',
        error: '#EF4444',
        warning: '#F59E0B',
        info: '#3B82F6',
      },
      fontSize: {
        'hero': 'clamp(3rem, 8vw, 7rem)',
      },
      spacing: {
        '18': '4.5rem',
        '88': '22rem',
      },
      animation: {
        'float': 'float 6s ease-in-out infinite',
      },
      keyframes: {
        float: {
          '0%, 100%': { transform: 'translateY(0px)' },
          '50%': { transform: 'translateY(-10px)' },
        }
      },
      backdropBlur: {
        'xs': '2px',
      },
      transitionDuration: {
        '300': '300ms',
      },
      transitionTimingFunction: {
        'premium': 'cubic-bezier(0.4, 0, 0.2, 1)',
      },
    },
  },
  plugins: [],
}

export default config</parameter>
</invoke>
<invoke name="file">
<parameter name="filePath">app/page.tsx</parameter>
<parameter name="contentType">content</parameter>
<parameter name="content">'use client';

import '@/lib/timer-shims';
import { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Search, Trophy, BarChart3, RefreshCw, Clock, TrendingUp, Crown, Target, Zap, ArrowRight, ChevronRight } from 'lucide-react';
import PlayerHeader from '@/components/PlayerHeader';
import TrophyChart from '@/components/TrophyChart';
import BattleHistory from '@/components/BattleHistory';
import LeagueInfo from '@/components/LeagueInfo';
import SessionHistory from '@/components/SessionHistory';
import { usePolling } from '@/lib/usePolling';
import { getArenaByTrophies } from '@/lib/arenas';
import { parseClashTime, formatDateTime } from '@/lib/time';

async function fetchJson(url: string) {
  try {
    const r = await fetch(url, { cache: 'no-store' });
    if (!r.ok) throw new Error(await r.text());
    return r.json();
  } catch (e: any) {
    if (e?.name === 'AbortError') {
      return null;
    }
    throw e;
  }
}

export default function Page() {
  const defaultTag = 'U9UUCCQ';
  const [tag, setTag] = useState<string>('');
  const [player, setPlayer] = useState<any>(null);
  const [summary, setSummary] = useState<any>(null);
  const [battles, setBattles] = useState<any[]>([]);
  const [loading, setLoading] = useState<boolean>(false);
  const [err, setErr] = useState<string | null>(null);
  const [showPlayerData, setShowPlayerData] = useState<boolean>(false);
  const [activeTab, setActiveTab] = useState<string>('resumo');
  const [lastUpdated, setLastUpdated] = useState<Date | null>(null);
  const [isRefreshing, setIsRefreshing] = useState<boolean>(false);

  async function load(t: string) {
    setLoading(true); 
    setErr(null);
    try {
      const [p, s, b] = await Promise.all([
        fetchJson(`/api/player/${t}`),
        fetchJson(`/api/player/${t}/summary?last=20`),
        fetchJson(`/api/player/${t}/battles?last=20`)
      ]);
      setPlayer(p); 
      setSummary(s); 
      setBattles(b);
      setShowPlayerData(true);
      setLastUpdated(new Date());
    } catch (e: any) {
      setErr(e.message || 'Erro');
      setShowPlayerData(false);
    } finally { 
      setLoading(false); 
    }
  }

  function onSearch(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();
    const formData = new FormData(e.currentTarget);
    const inputValue = formData.get('tag') as string;
    const clean = inputValue.replace(/^#/, '').trim().toUpperCase();
    if (clean) { 
      setTag(clean); 
      load(clean); 
    }
  }

  function loadDefaultPlayer() {
    setTag(defaultTag);
    load(defaultTag);
  }

  async function refreshData() {
    if (!tag || loading) return;
    setIsRefreshing(true);
    try {
      const [p, s, b] = await Promise.all([
        fetchJson(`/api/player/${tag}`),
        fetchJson(`/api/player/${tag}/summary?last=20`),
        fetchJson(`/api/player/${tag}/battles?last=20`)
      ]);
      setPlayer(p); 
      setSummary(s); 
      setBattles(b);
      setLastUpdated(new Date());
    } finally {
      setIsRefreshing(false);
    }
  }

  // Auto-refresh when on live tab
  usePolling(async () => {
    if (showPlayerData && tag && !loading && !isRefreshing && activeTab === 'live') {
      await refreshData();
    }
  }, activeTab === 'live' ? 60000 : undefined);

  const features = [
    {
      icon: <Trophy className="w-6 h-6" />,
      title: "Estat√≠sticas Avan√ßadas",
      description: "M√©tricas profissionais para jogadores exigentes"
    },
    {
      icon: <BarChart3 className="w-6 h-6" />,
      title: "An√°lise de Performance",
      description: "Insights profundos sobre seu desempenho"
    },
    {
      icon: <Target className="w-6 h-6" />,
      title: "Tracking Inteligente",
      description: "Monitoramento em tempo real das suas partidas"
    },
    {
      icon: <Crown className="w-6 h-6" />,
      title: "Elite Dashboard",
      description: "Interface premium para jogadores de elite"
    }
  ];

  const stats = [
    { label: "Win Rate", value: "72%", icon: <TrendingUp className="w-5 h-5" /> },
    { label: "3 Coroas", value: "1,247", icon: <Crown className="w-5 h-5" /> },
    { label: "Melhor", value: "6,543", icon: <Trophy className="w-5 h-5" /> },
    { label: "Push", value: "+127", icon: <Zap className="w-5 h-5" /> }
  ];

  return (
    <div className="min-h-screen bg-black text-white gpu-accelerated">
      {/* Gradient Background */}
      <div className="gradient-bg fixed inset-0 pointer-events-none" />
      
      {/* Decorative Elements */}
      <div className="absolute top-1/4 left-1/4 w-32 h-32 border border-gray-800 rotate-45 opacity-20 float-animation" />
      <div className="absolute bottom-1/3 right-1/4 w-24 h-24 border border-gray-700 rotate-12 opacity-15 float-animation" style={{ animationDelay: '3s' }} />

      <AnimatePresence mode="wait">
        {!showPlayerData ? (
          /* Homepage */
          <motion.main
            key="homepage"
            initial={{ opacity: 0, y: 50 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -50 }}
            transition={{ duration: 0.8 }}
            className="relative z-10"
          >
            {/* Header */}
            <header className="fixed top-0 inset-x-0 z-50">
              <nav className="mx-auto max-w-7xl px-8">
                <motion.div 
                  initial={{ y: -100, opacity: 0 }}
                  animate={{ y: 0, opacity: 1 }}
                  transition={{ delay: 0.2, duration: 0.6 }}
                  className="mt-8 glass-premium p-4 flex items-center justify-between"
                >
                  <div className="flex items-center gap-4">
                    <motion.div 
                      className="w-10 h-10 bg-white rounded-xl flex items-center justify-center"
                      whileHover={{ scale: 1.1, rotate: 5 }}
                      transition={{ duration: 0.3 }}
                    >
                      <Crown className="w-6 h-6 text-black" />
                    </motion.div>
                    <div>
                      <span className="text-xl font-semibold text-glow">Clash Dex</span>
                      <div className="text-xs text-gray-400">by X1.Payments</div>
                    </div>
                  </div>
                  <div className="text-sm text-gray-400 hidden sm:block">
                    Premium Analytics Platform
                  </div>
                </motion.div>
              </nav>
            </header>

            {/* Hero Section */}
            <section className="px-8 pt-48 pb-24">
              <div className="mx-auto max-w-7xl">
                <div className="max-w-4xl mx-auto text-center">
                  <motion.div 
                    initial={{ opacity: 0, y: 100 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.4, duration: 1 }}
                    className="mb-12"
                  >
                    <motion.div 
                      className="w-32 h-32 bg-white rounded-3xl flex items-center justify-center mx-auto mb-12 card-glow"
                      whileHover={{ scale: 1.05, y: -10 }}
                      transition={{ duration: 0.6 }}
                    >
                      <Crown className="w-16 h-16 text-black" />
                    </motion.div>
                    
                    <h1 className="text-hero font-light text-glow mb-8">
                      Clash <span className="font-semibold">Dex</span>
                    </h1>
                    
                    <p className="text-xl text-gray-400 mb-4 max-w-2xl mx-auto leading-relaxed">
                      Para jogadores que n√£o aceitam menos que a <span className="text-white font-medium">perfei√ß√£o</span>
                    </p>
                    
                    <p className="text-gray-500 mb-16">
                      Analytics premium ‚Ä¢ Interface elite ‚Ä¢ Performance excepcional
                    </p>
                  </motion.div>

                  {/* Search Form */}
                  <motion.div 
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ delay: 0.6, duration: 0.6 }}
                    className="max-w-lg mx-auto mb-8"
                  >
                    <form onSubmit={onSearch}>
                      <div className="glass-premium glow-effect p-3">
                        <div className="relative">
                          <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                          <input 
                            name="tag" 
                            value={tag}
                            onChange={(e) => setTag(e.target.value)}
                            placeholder="Digite sua TAG (#XXXXXXX)"
                            className="w-full pl-12 pr-4 py-4 bg-transparent text-white placeholder:text-gray-500 focus:outline-none text-center focus-ring"
                          />
                        </div>
                      </div>
                      
                      <motion.button 
                        type="submit"
                        disabled={loading}
                        className="w-full mt-6 x1-button-primary disabled:opacity-50"
                        whileHover={{ scale: 1.02, y: -2 }}
                        whileTap={{ scale: 0.98 }}
                        transition={{ duration: 0.3 }}
                      >
                        {loading ? (
                          <div className="flex items-center justify-center gap-3">
                            <motion.div
                              animate={{ rotate: 360 }}
                              transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
                              className="w-5 h-5 border-2 border-black border-t-transparent rounded-full"
                            />
                            Analisando...
                          </div>
                        ) : (
                          <div className="flex items-center justify-center gap-2">
                            Analisar Jogador
                            <ArrowRight className="w-4 h-4" />
                          </div>
                        )}
                      </motion.button>
                    </form>

                    {/* Demo Button */}
                    <motion.div 
                      className="text-center mt-8"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 0.8, duration: 0.6 }}
                    >
                      <button 
                        onClick={loadDefaultPlayer}
                        className="x1-button-ghost flex items-center gap-2 mx-auto"
                      >
                        Ver demonstra√ß√£o
                        <ChevronRight className="w-4 h-4" />
                      </button>
                      <div className="text-xs text-gray-500 mt-3">
                        Exemplo com jogador de elite
                      </div>
                    </motion.div>
                  </motion.div>

                  {/* Loading State */}
                  <AnimatePresence>
                    {loading && (
                      <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        exit={{ opacity: 0, scale: 0.9 }}
                        className="flex items-center justify-center py-12"
                      >
                        <div className="glass-premium glow-effect px-8 py-6">
                          <div className="flex items-center gap-4 text-gray-400">
                            <motion.div
                              animate={{ rotate: 360 }}
                              transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
                              className="w-6 h-6 border-2 border-white border-t-transparent rounded-full"
                            />
                            <span>Processando dados do jogador...</span>
                          </div>
                        </div>
                      </motion.div>
                    )}
                  </AnimatePresence>
                  
                  {/* Error State */}
                  <AnimatePresence>
                    {err && (
                      <motion.div
                        initial={{ opacity: 0, y: 20 }}
                        animate={{ opacity: 1, y: 0 }}
                        exit={{ opacity: 0, y: -20 }}
                        className="glass-premium border-error p-6 text-error max-w-md mx-auto mt-8"
                      >
                        <div className="font-medium">Falha na an√°lise</div>
                        <div className="text-sm text-gray-400 mt-2">{err}</div>
                      </motion.div>
                    )}
                  </AnimatePresence>
                </div>
              </div>
            </section>

            {/* Features Section */}
            <section className="px-8 py-24">
              <div className="mx-auto max-w-7xl">
                <motion.div 
                  initial={{ opacity: 0, y: 50 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.4, duration: 0.8 }}
                  className="text-center mb-24"
                >
                  <h2 className="text-4xl md:text-6xl font-light text-glow mb-8">
                    Analytics de <span className="font-semibold">Elite</span>
                  </h2>
                  <p className="text-xl text-gray-400 max-w-3xl mx-auto">
                    Desenvolvido para jogadores que buscam <span className="text-white font-medium">excel√™ncia absoluta</span> em suas an√°lises
                  </p>
                </motion.div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                  {features.map((feature, index) => (
                    <motion.div
                      key={index}
                      initial={{ opacity: 0, y: 50 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.6 + index * 0.1, duration: 0.6 }}
                      whileHover={{ scale: 1.02, y: -4 }}
                      className="x1-card group cursor-pointer"
                    >
                      <div className="w-16 h-16 bg-gray-900 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-gray-800 transition-premium">
                        <div className="text-white">
                          {feature.icon}
                        </div>
                      </div>
                      <h3 className="text-xl font-medium text-white mb-4">{feature.title}</h3>
                      <p className="text-gray-400 leading-relaxed">{feature.description}</p>
                    </motion.div>
                  ))}
                </div>
              </div>
            </section>

            {/* Stats Preview */}
            <section className="px-8 py-24">
              <div className="mx-auto max-w-7xl">
                <motion.div 
                  initial={{ opacity: 0, y: 50 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.8, duration: 0.8 }}
                  className="text-center mb-16"
                >
                  <h2 className="text-4xl md:text-5xl font-light mb-6">Performance Premium</h2>
                  <p className="text-xl text-gray-400">M√©tricas que importam para jogadores de elite</p>
                </motion.div>

                <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 max-w-5xl mx-auto">
                  {stats.map((stat, index) => (
                    <motion.div
                      key={index}
                      initial={{ opacity: 0, scale: 0.8 }}
                      animate={{ opacity: 1, scale: 1 }}
                      transition={{ delay: 1 + index * 0.1, duration: 0.6 }}
                      whileHover={{ scale: 1.05 }}
                      className="x1-card text-center gpu-accelerated"
                    >
                      <div className="text-gray-400 mb-4 flex justify-center">
                        {stat.icon}
                      </div>
                      <div className="text-2xl sm:text-3xl font-light mb-2">{stat.value}</div>
                      <div className="text-gray-400 text-sm">{stat.label}</div>
                    </motion.div>
                  ))}
                </div>
              </div>
            </section>
          </motion.main>
        ) : (
          /* Player Dashboard */
          <motion.main
            key="dashboard"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.6 }}
            className="relative z-10"
          >
            {/* Header */}
            <header className="fixed top-0 inset-x-0 z-50">
              <nav className="mx-auto max-w-7xl px-8">
                <motion.div 
                  initial={{ y: -100, opacity: 0 }}
                  animate={{ y: 0, opacity: 1 }}
                  transition={{ duration: 0.6 }}
                  className="mt-8 glass-premium p-4 flex items-center justify-between"
                >
                  <div className="flex items-center gap-4">
                    <div className="w-10 h-10 bg-white rounded-xl flex items-center justify-center">
                      <Crown className="w-6 h-6 text-black" />
                    </div>
                    <div>
                      <span className="text-xl font-semibold text-glow">Clash Dex</span>
                      <div className="text-xs text-gray-400">by X1.Payments</div>
                    </div>
                  </div>
                  <motion.button 
                    onClick={() => setShowPlayerData(false)}
                    className="x1-button-ghost"
                    whileHover={{ x: -5 }}
                    transition={{ duration: 0.3 }}
                  >
                    ‚Üê Voltar
                  </motion.button>
                </motion.div>
              </nav>
            </header>

            <div className="pt-32 px-8">
              <div className="max-w-7xl mx-auto">
                {/* Player Header */}
                {player && (
                  <motion.div 
                    initial={{ opacity: 0, y: 50 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.8 }}
                    className="x1-card mb-12"
                  >
                    <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-8">
                      <div className="flex items-center gap-8">
                        <motion.div 
                          className="w-32 h-32 rounded-3xl bg-gray-900 flex items-center justify-center text-6xl card-glow"
                          whileHover={{ scale: 1.05 }}
                          transition={{ duration: 0.3 }}
                        >
                          üëë
                        </motion.div>
                        <div className="min-w-0 flex-1">
                          <div className="flex items-center gap-6 mb-4">
                            <h1 className="text-4xl md:text-6xl font-light text-glow">{player.name}</h1>
                            <span className="text-2xl text-gray-400 font-mono">#{player.tag}</span>
                          </div>
                          <div className="flex items-center gap-8 text-lg">
                            <div className="flex items-center gap-3">
                              <div className="w-3 h-3 bg-white rounded-full"></div>
                              <span className="text-gray-300">{getArenaByTrophies(player.trophies).name}</span>
                            </div>
                            {player.clan && (
                              <div className="flex items-center gap-3">
                                <div className="w-3 h-3 bg-gray-400 rounded-full"></div>
                                <span className="text-gray-300">{player.clan}</span>
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                      
                      <div className="flex items-center gap-8">
                        <div className="text-right">
                          <div className="text-6xl font-light text-glow mb-2">{player.trophies.toLocaleString()}</div>
                          <div className="text-gray-400 text-lg mb-2">Trof√©us Atuais</div>
                          <div className="text-gray-500">Melhor: {player.bestTrophies.toLocaleString()}</div>
                        </div>
                        
                        <motion.button
                          onClick={refreshData}
                          disabled={isRefreshing}
                          className="x1-button-secondary disabled:opacity-50"
                          whileHover={{ scale: 1.05 }}
                          whileTap={{ scale: 0.95 }}
                        >
                          <RefreshCw className={`w-5 h-5 ${isRefreshing ? 'animate-spin' : ''}`} />
                        </motion.button>
                      </div>
                    </div>
                    
                    {lastUpdated && (
                      <div className="text-sm text-gray-500 flex items-center gap-3 mt-8 pt-8 border-t border-gray-800">
                        <Clock className="w-4 h-4" />
                        <span>
                          √öltima atualiza√ß√£o: {lastUpdated.toLocaleString('pt-BR', {
                            timeZone: 'America/Sao_Paulo',
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                          })}
                        </span>
                      </div>
                    )}
                  </motion.div>
                )}

                {/* Tabs Navigation */}
                <motion.div 
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.2, duration: 0.6 }}
                  className="glass-premium mb-12"
                >
                  <div className="flex overflow-x-auto p-2">
                    {[
                      { id: 'resumo', label: 'Resumo', icon: <BarChart3 className="w-5 h-5" /> },
                      { id: 'historico', label: 'Hist√≥rico', icon: <Clock className="w-5 h-5" /> },
                      { id: 'estatisticas', label: 'Estat√≠sticas', icon: <Trophy className="w-5 h-5" /> },
                      { id: 'live', label: 'Ao Vivo', icon: <Zap className="w-5 h-5" /> }
                    ].map((tab) => (
                      <motion.button
                        key={tab.id}
                        onClick={() => setActiveTab(tab.id)}
                        className={`flex items-center gap-3 px-8 py-4 font-medium transition-premium rounded-2xl whitespace-nowrap ${
                          activeTab === tab.id
                            ? 'bg-white text-black'
                            : 'text-gray-400 hover:text-white hover:bg-white/5'
                        }`}
                        whileHover={{ scale: 1.02 }}
                        whileTap={{ scale: 0.98 }}
                      >
                        {tab.icon}
                        <span>{tab.label}</span>
                      </motion.button>
                    ))}
                  </div>
                </motion.div>

                {/* Tab Content */}
                <AnimatePresence mode="wait">
                  <motion.div
                    key={activeTab}
                    initial={{ opacity: 0, x: 20 }}
                    animate={{ opacity: 1, x: 0 }}
                    exit={{ opacity: 0, x: -20 }}
                    transition={{ duration: 0.4 }}
                    className="space-y-12"
                  >
                    {activeTab === 'resumo' && player && summary && (
                      <>
                        <LeagueInfo player={player} battles={battles} />
                        <TrophyChart series={summary.series} battles={battles} player={player} />
                        <SessionHistory battles={battles} />
                      </>
                    )}

                    {activeTab === 'historico' && (
                      <BattleHistory battles={battles} />
                    )}

                    {activeTab === 'estatisticas' && player && summary && (
                      <>
                        <TrophyChart series={summary.series} battles={battles} player={player} />
                        
                        <div className="grid grid-cols-2 lg:grid-cols-4 gap-8">
                          {[
                            { label: "Win Rate", value: `${summary.winRate}%`, color: "text-success", icon: <TrendingUp className="w-6 h-6" /> },
                            { label: "3 Coroas", value: player.threeCrownWins?.toLocaleString() || '0', color: "text-warning", icon: <Crown className="w-6 h-6" /> },
                            { label: "Melhor", value: player.bestTrophies?.toLocaleString() || '0', color: "text-info", icon: <Trophy className="w-6 h-6" /> },
                            { label: "Push", value: (summary.trophyDelta > 0 ? '+' : '') + summary.trophyDelta, color: summary.trophyDelta > 0 ? "text-success" : "text-error", icon: <Zap className="w-6 h-6" /> }
                          ].map((stat, index) => (
                            <motion.div
                              key={index}
                              initial={{ opacity: 0, scale: 0.8 }}
                              animate={{ opacity: 1, scale: 1 }}
                              transition={{ delay: 0.1 + index * 0.1, duration: 0.6 }}
                              whileHover={{ scale: 1.05, y: -4 }}
                              className="x1-card text-center"
                            >
                              <div className="text-gray-400 mb-4 flex justify-center">
                                {stat.icon}
                              </div>
                              <div className={`text-3xl font-light mb-2 ${stat.color}`}>{stat.value}</div>
                              <div className="text-gray-400">{stat.label}</div>
                            </motion.div>
                          ))}
                        </div>
                      </>
                    )}

                    {activeTab === 'live' && (
                      <div className="x1-card text-center py-24">
                        <motion.div
                          animate={{ rotate: 360 }}
                          transition={{ duration: 2, repeat: Infinity, ease: "linear" }}
                          className="w-16 h-16 border-2 border-white border-t-transparent rounded-full mx-auto mb-8"
                        />
                        <h2 className="text-2xl font-medium text-white mb-4">Monitoramento Ativo</h2>
                        <p className="text-gray-400">
                          Verificando atividade em tempo real...
                        </p>
                        {lastUpdated && (
                          <div className="text-sm text-gray-500 mt-6">
                            √öltima verifica√ß√£o: {lastUpdated.toLocaleString('pt-BR', {
                              hour: '2-digit',
                              minute: '2-digit',
                              second: '2-digit'
                            })}
                          </div>
                        )}
                      </div>
                    )}
                  </motion.div>
                </AnimatePresence>
              </div>
            </div>
          </motion.main>
        )}
      </AnimatePresence>

      {/* Footer */}
      <footer className="relative border-t border-gray-800 bg-black/50 backdrop-blur-md mt-24">
        <div className="max-w-7xl mx-auto px-8 py-12">
          <motion.div 
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1.2, duration: 0.8 }}
            className="flex flex-col md:flex-row items-center justify-between gap-6"
          >
            <div className="text-gray-400 text-center md:text-left">
              <span className="text-white font-medium">X1.ClashDex.com</span> ‚Ä¢ Powered by <span className="text-gray-300">X1.Payments</span>
            </div>
            <div className="text-gray-500 text-sm">
              Premium Analytics ‚Ä¢ Elite Performance ‚Ä¢ Exceptional Quality
            </div>
          </motion.div>
        </div>
      </footer>
    </div>
  );
}
</parameter>
</invoke>
<invoke name="file">
<parameter name="filePath">components/LeagueInfo.tsx</parameter>
<parameter name="contentType">content</parameter>
<parameter name="content">'use client';

import { motion } from 'framer-motion';
import { Trophy, Target } from 'lucide-react';
import { getArenaByTrophies, getNextArena, getArenaProgress, getArenaEmoji } from '@/lib/arenas';

interface LeagueInfoProps {
  player: any;
  battles?: any[];
}

export default function LeagueInfo({ player, battles = [] }: LeagueInfoProps) {
  const recentWinRate = battles.length > 0 ? 
    Math.round((battles.filter(b => b.result === 'WIN').length / battles.length) * 100) : 
    (player.wins && player.losses ? Math.round((player.wins / (player.wins + player.losses)) * 100) : 60);

  const avgTrophiesPerMatch = battles.length > 0 ? 
    battles.reduce((sum, battle) => sum + (battle.trophyChange || 0), 0) / battles.length : 
    0;

  const { current: currentArena, next: nextArena, progress } = getArenaProgress(player.trophies);
  const arenaEmoji = getArenaEmoji(currentArena);

  const trophiesNeeded = nextArena ? nextArena.minTrophies - player.trophies : 0;
  
  let estimatedMatches = 0;
  if (nextArena && trophiesNeeded > 0) {
    const avgWinTrophies = 30;
    const avgLossTrophies = -20;
    const expectedTrophiesPerGame = (recentWinRate / 100) * avgWinTrophies + (1 - recentWinRate / 100) * avgLossTrophies;
    
    if (expectedTrophiesPerGame > 0) {
      estimatedMatches = Math.ceil(trophiesNeeded / expectedTrophiesPerGame);
    } else {
      estimatedMatches = 999;
    }
  }
  
  const avgMinutesPerMatch = 4;
  const totalMinutes = estimatedMatches * avgMinutesPerMatch;
  const estimatedTimeHours = totalMinutes / 60;
  
  const formatEstimatedTime = (hours: number) => {
    if (hours > 168) return `${Math.round(hours / 24 / 7)}sem`;
    if (hours < 1) return `${Math.round(hours * 60)}min`;
    if (hours < 24) return `${Math.round(hours)}h`;
    return `${Math.round(hours / 24)}d`;
  };

  return (
    <motion.div 
      initial={{ opacity: 0, y: 30 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.8 }}
      className="x1-card"
    >
      {/* Header */}
      <div className="flex items-center justify-between mb-8">
        <div className="flex items-center gap-4">
          <Trophy className="w-8 h-8 text-white" />
          <div>
            <h2 className="text-2xl font-medium text-white">Arena League</h2>
            <p className="text-gray-400">Performance de elite</p>
          </div>
        </div>
        <div className="text-right text-gray-400">
          {currentArena.type === 'seasonal' ? 'Sazonal' : 
           currentArena.type === 'competitive' ? 'Competitivo' : 'Liga Fixa'}
        </div>
      </div>

      {/* Arena Display */}
      <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-8 mb-12">
        <div className="flex items-center gap-6">
          <motion.div 
            className="w-24 h-24 bg-gray-900 rounded-3xl flex items-center justify-center text-4xl card-glow"
            whileHover={{ scale: 1.1, rotate: 5 }}
            transition={{ duration: 0.3 }}
          >
            {arenaEmoji}
          </motion.div>
          <div>
            <div className="text-3xl font-medium text-white mb-2">{currentArena.name}</div>
            <div className="text-xl text-gray-400">{player.trophies.toLocaleString()} trof√©us</div>
          </div>
        </div>
        
        <div className="text-center lg:text-right">
          <div className="text-2xl font-medium text-white mb-2">Arena {currentArena.id}</div>
          <div className="text-gray-400">Win Rate {recentWinRate}%</div>
        </div>
      </div>

      {/* Progress Indicator */}
      <div className="mb-8">
        <div className="flex justify-between items-center mb-4">
          <span className="text-lg font-medium text-white">{player.trophies.toLocaleString()} trof√©us</span>
          {nextArena && (
            <span className="text-gray-400">
              Pr√≥xima: {nextArena.name} ({nextArena.minTrophies.toLocaleString()})
            </span>
          )}
        </div>
        
        <div className="h-2 bg-gray-800 rounded-full overflow-hidden relative">
          <motion.div 
            className="h-full bg-gradient-to-r from-white to-gray-300 rounded-full"
            initial={{ width: 0 }}
            animate={{ width: `${progress}%` }}
            transition={{ duration: 1.2, ease: "easeOut" }}
          />
        </div>
        
        <div className="flex justify-between items-center mt-4">
          <div className="flex items-center gap-2">
            <Trophy className="w-4 h-4 text-warning" />
            <span className="text-gray-400 text-sm">{currentArena.minTrophies.toLocaleString()} trof√©us</span>
          </div>
          {nextArena ? (
            <div className="text-right">
              <div className="text-gray-400 text-sm mb-1">
                Faltam: <span className="font-medium text-white">{trophiesNeeded.toLocaleString()}</span> trof√©us
              </div>
              <div className="flex items-center gap-4">
                <div className="text-gray-500 text-xs">
                  ~<span className="font-medium text-warning">{estimatedMatches}</span> partidas
                </div>
                {estimatedMatches < 999 && estimatedTimeHours > 0 && (
                  <div className="text-gray-500 text-xs">
                    <span className="font-medium text-info">{formatEstimatedTime(estimatedTimeHours)}</span>
                  </div>
                )}
              </div>
            </div>
          ) : (
            <div className="text-warning">üéØ Arena M√°xima</div>
          )}
        </div>
      </div>

      {/* Statistics Grid */}
      <div className="grid grid-cols-3 gap-8 pt-8 border-t border-gray-800">
        <div className="text-center">
          <div className="text-2xl font-light text-success mb-2">
            {avgTrophiesPerMatch > 0 ? '+' : ''}{Math.round(avgTrophiesPerMatch)}
          </div>
          <div className="text-gray-400 text-sm">M√©dia/Partida</div>
        </div>
        <div className="text-center">
          <div className="text-2xl font-light text-white mb-2">{recentWinRate}%</div>
          <div className="text-gray-400 text-sm">Win Rate</div>
        </div>
        <div className="text-center">
          <div className="text-2xl font-light text-warning mb-2">
            {battles.filter(b => b.result === 'WIN').length}
          </div>
          <div className="text-gray-400 text-sm">Vit√≥rias</div>
        </div>
      </div>
    </motion.div>
  );
}
</parameter>
</invoke>
<invoke name="file">
<parameter name="filePath">components/BattleHistory.tsx</parameter>
<parameter name="contentType">content</parameter>
<parameter name="content">'use client';

import { motion } from 'framer-motion';
import { Clock, Trophy, Swords, Target } from 'lucide-react';
import { formatAgo, formatDateTime } from '@/lib/time';

export default function BattleHistory({ battles }: { battles: any[] }) {
  return (
    <motion.div 
      initial={{ opacity: 0, y: 30 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.8 }}
      className="x1-card"
    >
      <div className="flex items-center gap-4 mb-12">
        <div className="w-12 h-12 bg-gray-900 rounded-2xl flex items-center justify-center">
          <Swords className="w-7 h-7 text-white" />
        </div>
        <div>
          <h2 className="text-2xl font-medium text-white">Hist√≥rico de Elite</h2>
          <p className="text-gray-400">An√°lise das √∫ltimas {battles.length} partidas</p>
        </div>
      </div>
      
      <div className="space-y-4">
        {battles.map((battle, index) => (
          <motion.div
            key={index}
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ delay: index * 0.05, duration: 0.4 }}
            whileHover={{ scale: 1.01, x: 4 }}
            className={`premium-gradient border transition-premium p-6 rounded-2xl ${
              battle.result === 'WIN' 
                ? 'border-success glow-effect' 
                : battle.result === 'LOSS' 
                ? 'border-error' 
                : 'border-gray-700'
            }`}
          >
            {/* Mobile Layout */}
            <div className="block lg:hidden">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-4">
                  <motion.div 
                    className={`w-12 h-12 rounded-2xl flex items-center justify-center font-medium ${
                      battle.result === 'WIN' ? 'bg-success text-black' : 
                      battle.result === 'LOSS' ? 'bg-error text-white' : 
                      'bg-gray-600 text-white'
                    }`}
                    whileHover={{ scale: 1.1 }}
                  >
                    {battle.result === 'WIN' ? '‚úì' : battle.result === 'LOSS' ? '‚úó' : '='}
                  </motion.div>
                  <div>
                    <div className="font-medium text-white">{battle.gameMode}</div>
                    <div className="text-sm text-gray-400">{battle.crownsFor} - {battle.crownsAgainst} coroas</div>
                  </div>
                </div>
                <div className="text-right">
                  <div className={`text-lg font-medium ${battle.trophyChange >= 0 ? 'text-success' : 'text-error'}`}>
                    {battle.trophyChange >= 0 ? '+' : ''}{battle.trophyChange}
                  </div>
                  <div className="text-xs text-gray-500">{formatAgo(battle.battleTime)}</div>
                </div>
              </div>
              <div className="text-sm text-gray-400">vs {battle.opponentName}</div>
            </div>

            {/* Desktop Layout */}
            <div className="hidden lg:flex items-center gap-8">
              <motion.div 
                className={`w-16 h-16 rounded-2xl flex items-center justify-center font-medium ${
                  battle.result === 'WIN' ? 'bg-success text-black' : 
                  battle.result === 'LOSS' ? 'bg-error text-white' : 
                  'bg-gray-600 text-white'
                }`}
                whileHover={{ scale: 1.1, rotate: 5 }}
                transition={{ duration: 0.3 }}
              >
                {battle.result === 'WIN' ? '‚úì' : battle.result === 'LOSS' ? '‚úó' : '='}
              </motion.div>
              
              <div className="flex-1">
                <div className="font-medium text-white text-lg mb-2">{battle.gameMode}</div>
                <div className="flex items-center gap-6 text-gray-400">
                  <span>vs {battle.opponentName}</span>
                  <span className="flex items-center gap-2">
                    <Target className="w-4 h-4" />
                    {battle.crownsFor} - {battle.crownsAgainst}
                  </span>
                </div>
              </div>
              
              <div className="text-right space-y-2">
                <div className={`text-2xl font-light ${battle.trophyChange >= 0 ? 'text-success' : 'text-error'}`}>
                  {battle.trophyChange >= 0 ? '+' : ''}{battle.trophyChange}
                </div>
                
                {battle.opponentTrophies > 0 && (
                  <div className="flex items-center gap-2 text-gray-400">
                    <Trophy className="w-4 h-4" />
                    <span className="text-sm">{battle.opponentTrophies}</span>
                  </div>
                )}
                
                <div className="text-sm text-gray-500 flex items-center gap-2">
                  <Clock className="w-4 h-4" />
                  <span>{formatAgo(battle.battleTime)}</span>
                </div>
              </div>
            </div>
          </motion.div>
        ))}
      </div>

      {/* Summary Stats */}
      <motion.div 
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: 0.4, duration: 0.6 }}
        className="grid grid-cols-3 gap-8 pt-8 mt-8 border-t border-gray-800"
      >
        <div className="text-center">
          <div className="text-xl font-light text-success mb-2">{battles.filter(b => b.result === 'WIN').length}</div>
          <div className="text-gray-400 text-sm">Vit√≥rias</div>
        </div>
        <div className="text-center">
          <div className="text-xl font-light text-error mb-2">{battles.filter(b => b.result === 'LOSS').length}</div>
          <div className="text-gray-400 text-sm">Derrotas</div>
        </div>
        <div className="text-center">
          <div className="text-xl font-light text-white mb-2">{recentWinRate}%</div>
          <div className="text-gray-400 text-sm">Efici√™ncia</div>
        </div>
      </motion.div>
    </motion.div>
  );
}
</parameter>
</invoke>
<invoke name="file">
<parameter name="filePath">components/TrophyChart.tsx</parameter>
<parameter name="contentType">content</parameter>
<parameter name="content">'use client';

import { useState } from 'react';
import { motion } from 'framer-motion';
import { BarChart3, Filter } from 'lucide-react';
import { parseClashTime, formatDateTime } from '@/lib/time';
import dynamic from 'next/dynamic';

const ReLineChart = dynamic(() => import('./_TrophyChartImpl'), { ssr: false });

type Period = '60D' | '30D' | '15D' | '6D' | 'Today';

export default function TrophyChart({ series, battles, player }: { series: any[]; battles?: any[]; player?: any }) {
  const [selectedPeriod, setSelectedPeriod] = useState<Period>('15D');

  const getFilteredData = () => {
    if (!battles || battles.length === 0 || !player) return series;

    const now = new Date();
    let cutoffDate: Date;

    switch (selectedPeriod) {
      case '60D':
        cutoffDate = new Date(now.getTime() - 60 * 24 * 60 * 60 * 1000);
        break;
      case '30D':
        cutoffDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
        break;
      case '15D':
        cutoffDate = new Date(now.getTime() - 15 * 24 * 60 * 60 * 1000);
        break;
      case '6D':
        cutoffDate = new Date(now.getTime() - 6 * 24 * 60 * 60 * 1000);
        break;
      case 'Today':
        cutoffDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        break;
      default:
        return series;
    }

    const filteredBattles = battles
      .filter(battle => {
        const battleDate = parseClashTime(battle.battleTime);
        return battleDate && battleDate >= cutoffDate;
      })
      .sort((a, b) => {
        const dateA = parseClashTime(a.battleTime);
        const dateB = parseClashTime(b.battleTime);
        if (!dateA || !dateB) return 0;
        return dateA.getTime() - dateB.getTime();
      });

    if (filteredBattles.length === 0) return [];

    let currentTrophies = player.trophies;
    
    for (const battle of filteredBattles.reverse()) {
      currentTrophies -= (battle.trophyChange || 0);
    }
    
    filteredBattles.reverse();
    
    const newSeries = [];
    let trophies = currentTrophies;
    
    if (selectedPeriod !== 'Today') {
      newSeries.push({
        label: formatDateTime(filteredBattles[0]?.battleTime, { 
          day: '2-digit',
          month: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        }),
        trophies: trophies
      });
    }
    
    filteredBattles.forEach(battle => {
      trophies += (battle.trophyChange || 0);
      
      let label;
      if (selectedPeriod === 'Today') {
        label = formatDateTime(battle.battleTime, { 
          dateStyle: undefined,
          timeStyle: 'short'
        });
      } else {
        label = formatDateTime(battle.battleTime, { 
          day: '2-digit',
          month: '2-digit',
          timeStyle: undefined
        });
      }
      
      newSeries.push({
        label: label,
        trophies: trophies
      });
    });

    return newSeries;
  };

  const periods: { value: Period; label: string }[] = [
    { value: '60D', label: '60D' },
    { value: '30D', label: '30D' },
    { value: '15D', label: '15D' },
    { value: '6D', label: '6D' },
    { value: 'Today', label: 'Hoje' }
  ];

  const chartData = getFilteredData();
  const hasVariation = chartData.length > 1 ? chartData[chartData.length - 1]?.trophies - chartData[0]?.trophies : 0;
  const peakTrophies = chartData.length > 0 ? Math.max(...chartData.map(d => d.trophies)) : 0;

  return (
    <motion.div 
      initial={{ opacity: 0, y: 30 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.8 }}
      className="x1-card"
    >
      <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-8">
        <div className="flex items-center gap-4">
          <div className="w-12 h-12 bg-gray-900 rounded-2xl flex items-center justify-center">
            <BarChart3 className="w-7 h-7 text-white" />
          </div>
          <div>
            <h2 className="text-2xl font-medium text-white">Performance Analytics</h2>
            <p className="text-gray-400">Evolu√ß√£o de trof√©us premium</p>
          </div>
        </div>
        
        <div className="flex items-center gap-2">
          <Filter className="w-5 h-5 text-gray-400" />
          <div className="flex items-center gap-2">
            {periods.map((period) => (
              <motion.button
                key={period.value}
                onClick={() => setSelectedPeriod(period.value)}
                className={`px-4 py-2 text-sm font-medium rounded-xl transition-premium ${
                  selectedPeriod === period.value
                    ? 'bg-white text-black'
                    : 'bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white'
                }`}
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
              >
                {period.label}
              </motion.button>
            ))}
          </div>
        </div>
      </div>
      
      <motion.div 
        initial={{ opacity: 0, scale: 0.95 }}
        animate={{ opacity: 1, scale: 1 }}
        transition={{ delay: 0.2, duration: 0.6 }}
        className="h-80 glass-premium rounded-2xl p-6 mb-8"
      >
        <ReLineChart data={chartData} />
      </motion.div>
      
      {/* Chart Statistics */}
      <motion.div 
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: 0.4, duration: 0.6 }}
        className="grid grid-cols-3 gap-8 pt-8 border-t border-gray-800"
      >
        <div className="text-center">
          <div className="text-xl font-light text-info mb-2">{chartData.length}</div>
          <div className="text-gray-400 text-sm">Data Points</div>
        </div>
        <div className="text-center">
          <div className={`text-xl font-light mb-2 ${hasVariation >= 0 ? 'text-success' : 'text-error'}`}>
            {hasVariation >= 0 ? '+' : ''}{hasVariation}
          </div>
          <div className="text-gray-400 text-sm">Varia√ß√£o</div>
        </div>
        <div className="text-center">
          <div className="text-xl font-light text-warning mb-2">
            {peakTrophies.toLocaleString()}
          </div>
          <div className="text-gray-400 text-sm">Pico</div>
        </div>
      </motion.div>
    </motion.div>
  );
}
</parameter>
</invoke>
<invoke name="file">
<parameter name="filePath">components/SessionHistory.tsx</parameter>
<parameter name="contentType">content</parameter>
<parameter name="content">'use client';

import { motion } from 'framer-motion';
import { Clock, Trophy, TrendingUp, Calendar, Target } from 'lucide-react';
import { parseClashTime, formatDateTime, formatAgo } from '@/lib/time';

// Group battles by sessions based on time gaps
function groupBattlesBySessions(battles: any[]) {
  if (!battles.length) return [];
  
  const sessions = [];
  let currentSession = [];
  const SESSION_GAP_MINUTES = 30;
  
  for (let i = 0; i < battles.length; i++) {
    const battle = battles[i];
    const battleTime = parseClashTime(battle.battleTime);
    
    if (!battleTime) continue;
    
    if (currentSession.length === 0) {
      currentSession.push(battle);
    } else {
      const lastBattle = currentSession[currentSession.length - 1];
      const lastBattleTime = parseClashTime(lastBattle.battleTime);
      
      if (!lastBattleTime) {
        currentSession.push(battle);
        continue;
      }
      
      const timeDiff = (lastBattleTime.getTime() - battleTime.getTime()) / (1000 * 60);
      
      if (timeDiff > SESSION_GAP_MINUTES) {
        sessions.push([...currentSession]);
        currentSession = [battle];
      } else {
        currentSession.push(battle);
      }
    }
  }
  
  if (currentSession.length > 0) {
    sessions.push(currentSession);
  }
  
  return sessions.map((sessionBattles, index) => {
    const wins = sessionBattles.filter(b => b.result === 'WIN').length;
    const losses = sessionBattles.filter(b => b.result === 'LOSS').length;
    const winRate = sessionBattles.length > 0 ? Math.round((wins / sessionBattles.length) * 100) : 0;
    const trophyChange = sessionBattles.reduce((sum, b) => sum + (b.trophyChange || 0), 0);
    
    const startTime = parseClashTime(sessionBattles[sessionBattles.length - 1].battleTime);
    const endTime = parseClashTime(sessionBattles[0].battleTime);
    const duration = (startTime && endTime) ? endTime.getTime() - startTime.getTime() : 0;
    const daysAgo = endTime ? Math.floor((Date.now() - endTime.getTime()) / (1000 * 60 * 60 * 24)) : 0;
    
    return {
      id: index,
      battles: sessionBattles,
      wins,
      losses,
      total: sessionBattles.length,
      winRate,
      trophyChange,
      startTime,
      endTime,
      duration,
      daysAgo
    };
  });
}

function formatTimeAgo(daysAgo: number) {
  if (daysAgo === 0) return 'Hoje';
  if (daysAgo === 1) return 'Ontem';
  return `${daysAgo} dias atr√°s`;
}

function formatSessionDuration(ms: number) {
  if (!ms || ms < 0) return '‚Äî';
  const totalMinutes = Math.floor(ms / 60000);
  const hours = Math.floor(totalMinutes / 60);
  const minutes = totalMinutes % 60;
  
  if (hours > 0) return `${hours}h ${minutes}m`;
  return `${minutes}m`;
}

export default function SessionHistory({ battles }: { battles: any[] }) {
  const sessions = groupBattlesBySessions(battles);
  
  if (sessions.length === 0) {
    return (
      <motion.div 
        initial={{ opacity: 0, y: 30 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8 }}
        className="x1-card text-center py-24"
      >
        <Calendar className="w-16 h-16 text-gray-600 mx-auto mb-6" />
        <h2 className="text-2xl font-medium text-white mb-4">Nenhuma Sess√£o</h2>
        <p className="text-gray-400">Hist√≥rico n√£o dispon√≠vel no momento</p>
      </motion.div>
    );
  }

  return (
    <motion.div 
      initial={{ opacity: 0, y: 30 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.8 }}
      className="x1-card"
    >
      <div className="flex items-center gap-4 mb-12">
        <div className="w-12 h-12 bg-gray-900 rounded-2xl flex items-center justify-center">
          <Calendar className="w-7 h-7 text-white" />
        </div>
        <div>
          <h2 className="text-2xl font-medium text-white">Sess√µes de Elite</h2>
          <p className="text-gray-400">{sessions.length} sess√µes analisadas</p>
        </div>
      </div>
      
      <div className="space-y-8">
        {sessions.map((session, index) => (
          <motion.div
            key={session.id}
            initial={{ opacity: 0, x: -30 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ delay: index * 0.1, duration: 0.6 }}
            className="space-y-4"
          >
            {/* Session Header */}
            <motion.div 
              className="glass-premium p-6 rounded-2xl"
              whileHover={{ scale: 1.01 }}
            >
              <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div className="flex items-center gap-6">
                  <div className="text-white font-medium text-lg">{formatTimeAgo(session.daysAgo)}</div>
                  <div className="text-gray-400">‚Ä¢</div>
                  <div className="text-gray-400">{session.total} partidas</div>
                  <div className="text-gray-400">‚Ä¢</div>
                  <div className="text-gray-400">{session.wins}V {session.losses}L</div>
                </div>
                
                <div className="flex items-center gap-6">
                  <div className={`font-medium ${session.trophyChange >= 0 ? 'text-success' : 'text-error'}`}>
                    {session.trophyChange >= 0 ? '+' : ''}{session.trophyChange} trof√©us
                  </div>
                  <div className="text-gray-400">{formatSessionDuration(session.duration)}</div>
                  <div className="text-info">{session.winRate}%</div>
                </div>
              </div>
            </motion.div>
            
            {/* Session Battles */}
            <div className="space-y-3 pl-4">
              {session.battles.slice(0, 5).map((battle, battleIndex) => (
                <motion.div
                  key={battleIndex}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.1 + battleIndex * 0.05, duration: 0.4 }}
                  whileHover={{ scale: 1.01, x: 8 }}
                  className={`premium-gradient border rounded-xl p-4 transition-premium ${
                    battle.result === 'WIN' ? 'border-success' : 'border-error'
                  }`}
                >
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-4">
                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-medium ${
                        battle.result === 'WIN' ? 'bg-success text-black' : 'bg-error text-white'
                      }`}>
                        {battle.result === 'WIN' ? '‚úì' : '‚úó'}
                      </div>
                      
                      <div>
                        <div className="font-medium text-white">{battle.gameMode}</div>
                        <div className="text-sm text-gray-400">
                          vs {battle.opponentName} ‚Ä¢ {battle.crownsFor}-{battle.crownsAgainst}
                        </div>
                      </div>
                    </div>
                    
                    <div className="text-right">
                      <div className={`text-lg font-medium ${battle.trophyChange >= 0 ? 'text-success' : 'text-error'}`}>
                        {battle.trophyChange >= 0 ? '+' : ''}{battle.trophyChange}
                      </div>
                      <div className="text-xs text-gray-500">{formatAgo(battle.battleTime)}</div>
                    </div>
                  </div>
                </motion.div>
              ))}
              
              {session.battles.length > 5 && (
                <div className="text-center text-gray-500 text-sm py-2">
                  +{session.battles.length - 5} partidas adicionais
                </div>
              )}
            </div>
          </motion.div>
        ))}
      </div>
    </motion.div>
  );
}
</parameter>
</invoke>
<invoke name="file">
<parameter name="filePath">components/_TrophyChartImpl.tsx</parameter>
<parameter name="contentType">content</parameter>
<parameter name="content">'use client';

import { ResponsiveContainer, LineChart, Line, XAxis, YAxis, Tooltip } from 'recharts';

export default function TrophyChartImpl({ data }: { data: any[] }) {
  const calculateDomain = () => {
    if (!data || data.length === 0) return [0, 1000];
    
    const trophies = data.map(d => d.trophies);
    const min = Math.min(...trophies);
    const max = Math.max(...trophies);
    
    const range = max - min;
    const margin = Math.max(range * 0.1, 50);
    
    return [
      Math.floor((min - margin) / 50) * 50,
      Math.ceil((max + margin) / 50) * 50
    ];
  };
  
  const [minDomain, maxDomain] = calculateDomain();

  return (
    <ResponsiveContainer width="100%" height="100%">
      <LineChart data={data} margin={{ top: 20, left: 20, right: 20, bottom: 20 }}>
        <XAxis 
          dataKey="label" 
          stroke="#6B7280" 
          fontSize={12}
          tick={{ fill: '#9CA3AF' }}
          tickLine={{ stroke: '#374151' }}
          axisLine={{ stroke: '#374151' }}
          interval="preserveStartEnd"
        />
        <YAxis 
          width={80} 
          stroke="#6B7280" 
          fontSize={12}
          domain={[minDomain, maxDomain]}
          tickFormatter={(value) => value.toLocaleString()}
          tick={{ fill: '#9CA3AF' }}
          tickLine={{ stroke: '#374151' }}
          axisLine={{ stroke: '#374151' }}
        />
        <Tooltip 
          contentStyle={{ 
            background: 'rgba(0, 0, 0, 0.9)', 
            border: '1px solid #374151', 
            borderRadius: 16, 
            color: '#fff',
            boxShadow: '0 10px 40px rgba(0,0,0,0.5)',
            backdropFilter: 'blur(20px)'
          }}
          labelStyle={{ color: '#9CA3AF', fontWeight: 500 }}
          formatter={(value: any) => [
            <span style={{ color: '#FFFFFF', fontWeight: 600 }}>{value.toLocaleString()}</span>, 
            'Trof√©us'
          ]}
        />
        <Line 
          type="monotone" 
          dataKey="trophies" 
          stroke="#FFFFFF" 
          strokeWidth={3} 
          dot={{ fill: '#FFFFFF', strokeWidth: 0, r: 4 }}
          activeDot={{ 
            r: 8, 
            stroke: '#FFFFFF', 
            strokeWidth: 3, 
            fill: '#000000',
            filter: 'drop-shadow(0 0 8px rgba(255,255,255,0.6))'
          }}
        />
      </LineChart>
    </ResponsiveContainer>
  );
}
</parameter>
</invoke>
<invoke name="shell">
<parameter name="command">rm -f components/PlayerHeader.tsx components/SummaryCards.tsx components/CurrentPush.tsx components/GradientOrbs.tsx</parameter>
</invoke>