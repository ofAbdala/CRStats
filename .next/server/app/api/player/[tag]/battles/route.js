"use strict";(()=>{var e={};e.id=869,e.ids=[869],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},44063:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>T,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>y});var r={};a.r(r),a.d(r,{GET:()=>g,dynamic:()=>d,runtime:()=>c});var n=a(49303),o=a(88716),i=a(60670),s=a(87070),l=a(67093),u=a(46517),m=a(82851),p=a(57435);let c="nodejs",d="force-dynamic";async function g(e,{params:t}){try{let{searchParams:a}=new URL(e.url),r=Math.max(1,Math.min(50,parseInt(a.get("last")||"25",10))),n=`${(0,l.v2)()}/players/${(0,l.xy)(t.tag)}/battlelog`;p.k.api("GET /api/player/[tag]/battles",{tag:t.tag,last:r});let o=await (0,m.q)(n,{headers:(0,l.$V)()});if(!o.ok){let e=await o.text().catch(()=>"");return p.k.error("Supercell API error",{status:o.status,tag:t.tag}),s.NextResponse.json({error:!0,status:o.status,body:e||o.statusText},{status:o.status})}let i=(await o.json()).slice(0,r).map(u.d),c=s.NextResponse.json(i);return c.headers.set("Cache-Control","private, max-age=15"),c}catch(e){return p.k.error("Failed to fetch battles",e),s.NextResponse.json({code:500,message:e.message||"Internal error"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/player/[tag]/battles/route",pathname:"/api/player/[tag]/battles",filename:"route",bundlePath:"app/api/player/[tag]/battles/route"},resolvedPagePath:"/Users/sr.abdala/Documents/CRStats/CRStats/app/api/player/[tag]/battles/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:w}=h,T="/api/player/[tag]/battles/route";function b(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:y})}},82851:(e,t,a)=>{a.d(t,{q:()=>r});async function r(e,t={},a={}){let r=a.timeoutMs??1e4,n=a.retries??2;for(let a=0;a<=n;a++){let o=new AbortController,i=setTimeout(()=>o.abort(),r);try{let a=await fetch(e,{...t,cache:"no-store",signal:o.signal,headers:{Accept:"application/json","User-Agent":"clash-next/1.0",...t.headers||{}}});return clearTimeout(i),a}catch(t){if(clearTimeout(i),a===n)throw t;let e=300*(a+1)+Math.floor(200*Math.random());await new Promise(t=>setTimeout(t,e))}}throw Error("unreachable")}},57435:(e,t,a)=>{a.d(t,{k:()=>n});class r{formatMessage(e,t,a){return{timestamp:new Date().toISOString(),level:e,message:t,data:a}}debug(e,t){if(this.isDevelopment){let a=this.formatMessage("debug",e,t);console.log(`[DEBUG] ${a.timestamp} - ${e}`,t||"")}}info(e,t){if(this.isDevelopment){let a=this.formatMessage("info",e,t);console.info(`[INFO] ${a.timestamp} - ${e}`,t||"")}}warn(e,t){let a=this.formatMessage("warn",e,t);console.warn(`[WARN] ${a.timestamp} - ${e}`,t||"")}error(e,t){let a=this.formatMessage("error",e,t);console.error(`[ERROR] ${a.timestamp} - ${e}`,t||"")}api(e,t){if(this.isDevelopment&&t){let a={route:e,...t};a.tag&&(a.tag=`#${String(a.tag).slice(0,3)}***`),this.debug("API Call",a)}}constructor(){this.isDevelopment=!1}}let n=new r},46517:(e,t,a)=>{a.d(t,{e:()=>s,d:()=>i});let r=["localeMatcher","calendar","numberingSystem","timeZone","hour12","hourCycle","formatMatcher","weekDay","weekday","era","year","month","day","hour","minute","second","timeZoneName","dayPeriod","fractionalSecondDigits"];function n(e){if(!e||"string"!=typeof e)return null;if(/^\d{4}-\d{2}-\d{2}T/.test(e)){let t=new Date(e);return isNaN(t.getTime())?null:t}let t=e.match(/^(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})(\.\d+)?Z$/);if(!t)return null;let[,a,r,n,o,i,s,l=".000"]=t,u=new Date(`${a}-${r}-${n}T${o}:${i}:${s}${l}Z`);return isNaN(u.getTime())?null:u}function o(e,t={}){let a=function(e){if(null==e)return null;let t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?null:t}(e);return a?function(e,t){try{return new Intl.DateTimeFormat("pt-BR",t).format(e)}catch{let a={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:t.timeZone??"America/Sao_Paulo",hour12:!1};return new Intl.DateTimeFormat("pt-BR",a).format(e)}}(a,function(e){let t={},a={...e};for(let e of(void 0!==a.weekDay&&void 0===a.weekday&&(a.weekday=a.weekDay),r)){let r=a[e];void 0!==r&&(t[e]=r)}return t}({timeZone:"America/Sao_Paulo",...t})):"â€”"}function i(e){let t=e?.team?.[0]??{},a=e?.opponent?.[0]??{},r=t.crowns??0,n=a.crowns??0,i=o(e.battleTime);return{battleTime:e.battleTime,battleTimeFormatted:i,type:e.type||"PvP",gameMode:{id:e.gameMode?.id||0,name:e.gameMode?.name||"Unknown"},team:e.team||[t],opponent:e.opponent||[a],result:r>n?"WIN":r<n?"LOSS":"DRAW",crownsFor:r,crownsAgainst:n,opponentName:a.name??"",opponentTag:(a.tag??"").replace("#",""),opponentTrophies:a.startingTrophies??0,teamDeck:(t.cards||[]).map(e=>e.name),opponentDeck:(a.cards||[]).map(e=>e.name),trophyChange:t.trophyChange??0}}function s(e,t){let a=t.filter(e=>n(e.battleTime)).sort((e,t)=>{let a=n(e.battleTime),r=n(t.battleTime);return a&&r?r.getTime()-a.getTime():0}),r=[...a].reverse(),i=e.trophies;for(let e of a)i-=e.trophyChange||0;let s=i,l=[];for(let e of r)s+=e.trophyChange||0,l.push({label:o(e.battleTime,{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),trophies:s});let u=a.filter(e=>"WIN"===e.result).length,m=a.filter(e=>"LOSS"===e.result).length,p=r[0]?.battleTime,c=r[r.length-1]?.battleTime,d=0;if(p&&c){let e=n(p),t=n(c);e&&t&&(d=t.getTime()-e.getTime())}return{tag:(e.tag||"").replace("#",""),name:e.name,trophiesNow:e.trophies,trophiesStart:i,trophyDelta:e.trophies-i,matchesTotal:a.length,wins:u,losses:m,winRate:a.length?Math.round(u/a.length*100):0,pushDurationMs:d,series:l}}},67093:(e,t,a)=>{function r(){return"false"===process.env.USE_PROXY?"https://api.clashroyale.com/v1":"https://proxy.royaleapi.dev/v1"}function n(e){return`%23${String(e).replace(/^#/,"").toUpperCase()}`}function o(){if(!process.env.SUPERCELL_TOKEN)throw Error("Missing SUPERCELL_TOKEN env");return{Authorization:`Bearer ${process.env.SUPERCELL_TOKEN}`}}a.d(t,{$V:()=>o,v2:()=>r,xy:()=>n})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(44063));module.exports=r})();