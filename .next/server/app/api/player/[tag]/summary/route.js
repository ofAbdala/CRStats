"use strict";(()=>{var e={};e.id=24,e.ids=[24],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8307:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>T,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>h,dynamic:()=>c,runtime:()=>p});var o=r(9303),n=r(8716),s=r(670),i=r(7070),l=r(912),u=r(6517),m=r(2851);let p="nodejs",c="force-dynamic";async function h(e,{params:t}){try{let{searchParams:r}=new URL(e.url),a=Math.max(1,Math.min(50,parseInt(r.get("last")||"20",10))),o=(0,l.xy)(t.tag);console.log("Fetching player and battles for summary:",`${(0,l.v2)()}/players/${o}`),console.log("BaseURL",(0,l.v2)(),process.env.USE_PROXY,!!process.env.SUPERCELL_TOKEN);let[n,s]=await Promise.all([(0,m.q)(`${(0,l.v2)()}/players/${o}`,{headers:(0,l.$V)()}),(0,m.q)(`${(0,l.v2)()}/players/${o}/battlelog`,{headers:(0,l.$V)()})]);if(!n.ok){let e=await n.text().catch(()=>"");return console.error("Player API error",n.status,e),i.NextResponse.json({error:!0,status:n.status,body:e||n.statusText},{status:n.status})}if(!s.ok){let e=await s.text().catch(()=>"");return console.error("Battles API error",s.status,e),i.NextResponse.json({error:!0,status:s.status,body:e||s.statusText},{status:s.status})}let p=await n.json(),c=(await s.json()).slice(0,a).map(u.d),h=(0,u.e)(p,c),d=i.NextResponse.json(h);return d.headers.set("Cache-Control","private, max-age=30"),d}catch(e){return console.error("Summary route crash",e),i.NextResponse.json({code:500,message:e.message||"Internal error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/player/[tag]/summary/route",pathname:"/api/player/[tag]/summary",filename:"route",bundlePath:"app/api/player/[tag]/summary/route"},resolvedPagePath:"/home/project/app/api/player/[tag]/summary/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:f}=d,T="/api/player/[tag]/summary/route";function w(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:y})}},2851:(e,t,r)=>{r.d(t,{q:()=>a});async function a(e,t={},r={}){let a=r.timeoutMs??1e4,o=r.retries??2;for(let r=0;r<=o;r++){let n=new AbortController,s=setTimeout(()=>n.abort(),a);try{let r=await fetch(e,{...t,cache:"no-store",signal:n.signal,headers:{Accept:"application/json","User-Agent":"clash-next/1.0",...t.headers||{}}});return clearTimeout(s),r}catch(t){if(clearTimeout(s),r===o)throw t;let e=300*(r+1)+Math.floor(200*Math.random());await new Promise(t=>setTimeout(t,e))}}throw Error("unreachable")}},6517:(e,t,r)=>{r.d(t,{e:()=>i,d:()=>s});var a={};r.r(a),r.d(a,{o0:()=>n});let o=["localeMatcher","calendar","numberingSystem","timeZone","hour12","hourCycle","formatMatcher","weekDay","weekday","era","year","month","day","hour","minute","second","timeZoneName","dayPeriod","fractionalSecondDigits"];function n(e,t={}){let r=function(e){if(null==e)return null;let t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?null:t}(e);return r?function(e,t){try{return new Intl.DateTimeFormat("pt-BR",t).format(e)}catch{let r={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:t.timeZone??"America/Sao_Paulo",hour12:!1};return new Intl.DateTimeFormat("pt-BR",r).format(e)}}(r,function(e){let t={},r={...e};for(let e of(void 0!==r.weekDay&&void 0===r.weekday&&(r.weekday=r.weekDay),o)){let a=r[e];void 0!==a&&(t[e]=a)}return t}({timeZone:"America/Sao_Paulo",...t})):"â€”"}function s(e){let t=e?.team?.[0]??{},r=e?.opponent?.[0]??{},a=t.crowns??0,o=r.crowns??0,s=n(e.battleTime);return{battleTime:e.battleTime,battleTimeFormatted:s,gameMode:e.gameMode?.name??"",result:a>o?"WIN":a<o?"LOSS":"DRAW",crownsFor:a,crownsAgainst:o,opponentName:r.name??"",opponentTag:(r.tag??"").replace("#",""),opponentTrophies:r.startingTrophies??0,teamDeck:(t.cards||[]).map(e=>e.name),opponentDeck:(r.cards||[]).map(e=>e.name),trophyChange:t.trophyChange??0}}function i(e,t){let r=t.filter(e=>(0,a.parseClashTime)(e.battleTime)).sort((e,t)=>{let r=(0,a.parseClashTime)(e.battleTime),o=(0,a.parseClashTime)(t.battleTime);return r&&o?o.getTime()-r.getTime():0}),o=[...r].reverse(),s=e.trophies;for(let e of r)s-=e.trophyChange||0;let i=s,l=[];for(let e of o)i+=e.trophyChange||0,l.push({label:n(e.battleTime,{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),trophies:i});let u=r.filter(e=>"WIN"===e.result).length,m=r.filter(e=>"LOSS"===e.result).length,p=o[0]?.battleTime,c=o[o.length-1]?.battleTime,h=0;if(p&&c){let e=(0,a.parseClashTime)(p),t=(0,a.parseClashTime)(c);e&&t&&(h=t.getTime()-e.getTime())}return{tag:(e.tag||"").replace("#",""),name:e.name,trophiesNow:e.trophies,trophiesStart:s,trophyDelta:e.trophies-s,matchesTotal:r.length,wins:u,losses:m,winRate:r.length?Math.round(u/r.length*100):0,pushDurationMs:h,series:l}}},912:(e,t,r)=>{function a(){return"false"===process.env.USE_PROXY?"https://api.clashroyale.com/v1":"https://proxy.royaleapi.dev/v1"}function o(e){return`%23${String(e).replace(/^#/,"").toUpperCase()}`}function n(){if(!process.env.SUPERCELL_TOKEN)throw Error("Missing SUPERCELL_TOKEN env");return{Authorization:`Bearer ${process.env.SUPERCELL_TOKEN}`}}r.d(t,{$V:()=>n,v2:()=>a,xy:()=>o})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(8307));module.exports=a})();