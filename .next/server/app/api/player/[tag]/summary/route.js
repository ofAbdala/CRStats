"use strict";(()=>{var e={};e.id=24,e.ids=[24],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8307:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>d,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>c,dynamic:()=>u});var o=r(9303),s=r(8716),n=r(670),p=r(7070),l=r(912),i=r(4033);let u="force-dynamic";async function c(e,{params:t}){try{let{searchParams:r}=new URL(e.url),a=Math.max(1,Math.min(50,parseInt(r.get("last")||"20",10))),o=(0,l.xy)(t.tag);console.log("Fetching player and battles for summary:",`${(0,l.v2)()}/players/${o}`);let[s,n]=await Promise.all([fetch(`${(0,l.v2)()}/players/${o}`,{headers:(0,l.$V)(),cache:"no-store"}),fetch(`${(0,l.v2)()}/players/${o}/battlelog`,{headers:(0,l.$V)(),cache:"no-store"})]);if(!s.ok){let e=await s.text();return console.error("Player API error",s.status,e),p.NextResponse.json({code:s.status,message:e||s.statusText},{status:s.status})}if(!n.ok){let e=await n.text();return console.error("Battles API error",n.status,e),p.NextResponse.json({code:n.status,message:e||n.statusText},{status:n.status})}let u=await s.json(),c=(await n.json()).slice(0,a).map(i.d),m=(0,i.e)(u,c),h=p.NextResponse.json(m);return h.headers.set("Cache-Control","private, max-age=30"),h}catch(e){return console.error("Summary route crash",e),p.NextResponse.json({code:500,message:e.message||"Internal error"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/player/[tag]/summary/route",pathname:"/api/player/[tag]/summary",filename:"route",bundlePath:"app/api/player/[tag]/summary/route"},resolvedPagePath:"/home/project/app/api/player/[tag]/summary/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:d}=m,y="/api/player/[tag]/summary/route";function f(){return(0,n.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:g})}},4033:(e,t,r)=>{function a(e){let t=e?.team?.[0]??{},r=e?.opponent?.[0]??{},a=t.crowns??0,o=r.crowns??0;return{battleTime:e.battleTime,gameMode:e.gameMode?.name??"",result:a>o?"WIN":a<o?"LOSS":"DRAW",crownsFor:a,crownsAgainst:o,opponentName:r.name??"",opponentTag:(r.tag??"").replace("#",""),teamDeck:(t.cards||[]).map(e=>e.name),opponentDeck:(r.cards||[]).map(e=>e.name),trophyChange:t.trophyChange??0}}function o(e,t){let r=[...t].reverse(),a=e.trophies;for(let e of t)a-=e.trophyChange||0;let o=a,s=[];for(let e of r)o+=e.trophyChange||0,s.push({label:new Date(e.battleTime+"Z").toLocaleString(),trophies:o});let n=t.filter(e=>"WIN"===e.result).length,p=t.filter(e=>"LOSS"===e.result).length,l=r[0]?.battleTime,i=r[r.length-1]?.battleTime,u=l&&i?new Date(i+"Z").getTime()-new Date(l+"Z").getTime():0;return{tag:(e.tag||"").replace("#",""),name:e.name,trophiesNow:e.trophies,trophiesStart:a,trophyDelta:e.trophies-a,matchesTotal:t.length,wins:n,losses:p,winRate:t.length?Math.round(n/t.length*100):0,pushDurationMs:u,series:s}}r.d(t,{d:()=>a,e:()=>o})},912:(e,t,r)=>{function a(){return"true"===process.env.USE_PROXY?"https://proxy.royaleapi.dev/v1":"https://api.clashroyale.com/v1"}function o(e){return`%23${String(e).replace(/^#/,"").toUpperCase()}`}function s(){if(!process.env.SUPERCELL_TOKEN)throw Error("Missing SUPERCELL_TOKEN env");return{Authorization:`Bearer ${process.env.SUPERCELL_TOKEN}`}}r.d(t,{$V:()=>s,v2:()=>a,xy:()=>o})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(8307));module.exports=a})();